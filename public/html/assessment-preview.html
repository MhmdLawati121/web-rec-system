<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recruitment System</title>
    <!-- Add Bootstrap CSS link here -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/template.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inria+Sans:wght@700&family=Rubik:wght@400&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/preview-assessment.css" />
  </head>

  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg custom-navbar">
      <a class="navbar-brand" href="#">
        <img
          class="logo"
          src="../pictures/SQU_logo.png"
          alt=""
          height="50"
          class="d-inline-block align-text-center"
        />
        SQU Careers
      </a>
      <button
        style="border-color: white"
        class="navbar-toggler custom-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"> </span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav custom-nav-item">
          <li class="nav-item">
            <a class="nav-link" href="#">About SQU</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="location.href='/'">Job Listings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Contact Us</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="main-content">
        <h1>Assessment Preview</h1>
        <section id="assessment"></section>

        <div id="assessmentPreview">
          <!-- Your assessment preview content will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Add Bootstrap JS and jQuery scripts here -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="../js/logout.js"></script>

    <script>
      window.addEventListener("DOMContentLoaded", function () {
        const documentHeight = document.body.clientHeight;
        const viewportHeight = window.innerHeight;

        if (documentHeight < viewportHeight) {
          const footer = document.querySelector(".custom-footer");
          footer.classList.add("footer-at-bottom");
        }
      });
      // Retrieve the assessment IDs from the query parameters
      const urlParams = new URLSearchParams(window.location.search);
      const tempIdEncoded = urlParams.get("assessmentData");
      const tempIds = decodeURIComponent(tempIdEncoded.slice(1, -1)).split(",");
      console.log(tempIds);

      // Retrieve the assessment data from the server
      document.addEventListener("DOMContentLoaded", async () => {
        for (const tempId of tempIds) {
          const data = await fetch(
            "/assessment/getAssessmentData?assessmentData=" + tempId
          );
          const info = await data.json();
          console.log(info);

          const section = document.getElementById("assessment");

          // Create elements to display assessment data
          const questionDiv = document.createElement("div");
          const imageElement = document.createElement("img");
          const questionText = document.createElement("p");
          const optionText = document.createElement("div");
          const optionsList = document.createElement("ul");

          // Populate elements with assessment data

          questionText.textContent = info.question;

          for (let i = 0; i < info.options.length; i++) {
            const tickType = document.createElement("input");
            if (info.answer.length > 1) tickType.type = "checkbox";
            else {
              tickType.type = "radio";
              tickType.name = "option" + tempId;
            }
            const option = document.createElement("li");
            const optionP = document.createElement("label");
            optionP.textContent = info.options[i];
            option.appendChild(optionP);
            option.appendChild(tickType);
            optionsList.appendChild(option);
          }

          // Append elements to the DOM
          questionDiv.appendChild(questionText);
          if (info.imagedata !== null) {
            imageElement.src = info.imagedata;
            questionDiv.appendChild(imageElement);
          }
          optionText.appendChild(optionsList);
          questionDiv.appendChild(optionText);
          section.appendChild(questionDiv);
        }
      });
    </script>
  </body>
</html>
